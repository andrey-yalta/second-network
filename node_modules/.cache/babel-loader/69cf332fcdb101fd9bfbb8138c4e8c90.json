{"ast":null,"code":"import { authAPI, headerAPI } from \"../api/api\";\nimport { Redirect } from \"react-router-dom\";\nimport React from \"react\";\nimport { dataKey } from \"redux-form/lib/util/eventConsts\";\nimport { stopSubmit } from \"redux-form\";\nconst SET_AUTH_DATA = \"SET-AUTH-DATA\";\nlet initialState = {\n  data: {},\n  userId: null,\n  isAuth: false\n};\n\nlet authReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"SET-AUTH-DATA\":\n      {\n        debugger;\n        return { ...state,\n          data: { ...action.data\n          },\n          userID: { ...action.data.data.id\n          }\n        };\n      }\n\n    case \"TOGGLE-IS-AUTH\":\n      {\n        debugger;\n        return { ...state,\n          isAuth: true\n        };\n      }\n\n    case \"AUTH-IS-OFF\":\n      {\n        debugger;\n        return { ...state,\n          isAuth: false,\n          data: {}\n        };\n      }\n\n    default:\n      return state;\n  }\n};\n\nexport const loginThunkCreator = (email, password, rememberMe = true) => {\n  return dispatch => {\n    authAPI.login(email, password, rememberMe).then(data => {\n      if (data.resultCode === 0) {\n        dispatch(getAuthUserData());\n      } else {\n        let message = data.messages.length > 0 ? data.messages[0] : \"some error\";\n        dispatch(stopSubmit(\"login\", {\n          _error: message\n        }));\n      }\n    });\n  };\n};\nexport const logoutThunkCreator = () => {\n  return dispatch => {\n    authAPI.logout().then(data => {\n      if (data.resultCode === 0) {\n        dispatch(authIsOff());\n      }\n    });\n  };\n};\nexport const getAuthUserData = () => {\n  //надо обязательно оборачивать два раза даже если в первом вызове ничего не передаём, видимо для кол-бэка\n  return dispatch => {\n    // dispatch(toggleIsFetching(true));\n    headerAPI.getHeader().then(data => {\n      debugger;\n      dispatch(setAuthData(data));\n\n      if (data.resultCode === 0) {\n        debugger;\n        dispatch(toggleIsAuth());\n      }\n    }); // debugger;\n  };\n};\nexport default authReducer;\nexport const authIsOff = () => ({\n  type: \"AUTH-IS-OFF\"\n});\nexport const toggleIsAuth = () => ({\n  type: \"TOGGLE-IS-AUTH\"\n});\nexport const setAuthData = data => ({\n  type: SET_AUTH_DATA,\n  data: data\n});","map":{"version":3,"sources":["/Users/andrejzaharcenko/Desktop/second-network/src/redux/auth-reducer.js"],"names":["authAPI","headerAPI","Redirect","React","dataKey","stopSubmit","SET_AUTH_DATA","initialState","data","userId","isAuth","authReducer","state","action","type","userID","id","loginThunkCreator","email","password","rememberMe","dispatch","login","then","resultCode","getAuthUserData","message","messages","length","_error","logoutThunkCreator","logout","authIsOff","getHeader","setAuthData","toggleIsAuth"],"mappings":"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","sourcesContent":["import {authAPI, headerAPI} from \"../api/api\";\nimport {Redirect} from \"react-router-dom\";\nimport React from \"react\";\nimport {dataKey} from \"redux-form/lib/util/eventConsts\";\nimport {stopSubmit} from \"redux-form\";\n\nconst SET_AUTH_DATA = \"SET-AUTH-DATA\";\nlet initialState ={\n    data:{},\n    userId:null,\n    isAuth:false,\n}\nlet  authReducer =(state = initialState,action)=>{\n    switch (action.type) {\n\n        case \"SET-AUTH-DATA\":{\n            debugger;\n            return { ...state, data: {...action.data}, userID:{...action.data.data.id}};\n        }\n        case \"TOGGLE-IS-AUTH\":{\n            debugger;\n            return {...state, isAuth: true};\n        }\n        case \"AUTH-IS-OFF\":{\n            debugger;\n            return {...state, isAuth: false, data:{}};\n        }\n        default:\n            return state;\n    }\n}\n\nexport const loginThunkCreator =(email, password, rememberMe = true)=>{\n    return(dispatch)=>{\n\n        authAPI.login(email,password,rememberMe)\n            .then(\n                data=>{\n\n                    if(data.resultCode ===0){\n                        dispatch(getAuthUserData());\n                    }\n                    else {\n                        let message = data.messages.length >0 ? data.messages[0] :\"some error\";\n\n                        dispatch(stopSubmit(\"login\",{_error:message}));\n                    }\n                }\n            )\n    }\n}\nexport const logoutThunkCreator =()=>{\n    return(dispatch)=>{\n        authAPI.logout()\n            .then(\n                data=>{\n                    if(data.resultCode ===0){\n\n                        dispatch(authIsOff());\n\n\n                    }\n                }\n            )\n    }\n}\n\nexport const getAuthUserData= ()=>{\n    //надо обязательно оборачивать два раза даже если в первом вызове ничего не передаём, видимо для кол-бэка\n    return(dispatch)=>\n    {\n\n        // dispatch(toggleIsFetching(true));\n        headerAPI.getHeader()\n            .then(data => {\n                debugger;\n                dispatch(setAuthData(data));\n                if(data.resultCode ===0){\n                    debugger;\n                    dispatch(toggleIsAuth());\n                }\n\n            })\n        // debugger;\n    }\n}\n\n\n\nexport default authReducer;\nexport const authIsOff =()=>({type: \"AUTH-IS-OFF\"})\nexport const toggleIsAuth =()=>({type:\"TOGGLE-IS-AUTH\" })\nexport const setAuthData =(data)=>({type:SET_AUTH_DATA, data:data})"]},"metadata":{},"sourceType":"module"}